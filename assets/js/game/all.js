/*
 jCanvas v14.05.20
 Copyright 2014 Caleb Evans
 Released under the MIT license
*/
(function(g,ua,va,Ra,ca,ea,$a,q,y,h,v){function H(d){for(var c in d)d.hasOwnProperty(c)&&(this[c]=d[c]);return this}function ma(){Z(this,ma.baseDefaults)}function ja(d){return"string"===aa(d)}function L(d){return d&&d.getContext?d.getContext("2d"):h}function ka(d){d=Z({},d);d.masks=d.masks.slice(0);return d}function fa(d,c){var a;d.save();a=ka(c.transforms);c.savedTransforms.push(a)}function wa(d,c,a,b){a[b]&&(da(a[b])?c[b]=a[b].call(d,a):c[b]=a[b])}function T(d,c,a){wa(d,c,a,"fillStyle");wa(d,c,
a,"strokeStyle");c.lineWidth=a.strokeWidth;a.rounded?c.lineCap=c.lineJoin="round":(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);a.strokeDash||(a.strokeDash=[]);c.setLineDash&&c.setLineDash(a.strokeDash);c.webkitLineDash=c.mozDash=a.strokeDash;c.lineDashOffset=c.webkitLineDashOffset=c.mozDashOffset=a.strokeDashOffset;c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=
a.compositing;a.imageSmoothing&&(c.webkitImageSmoothingEnabled=c.mozImageSmoothingEnabled=a.imageSmoothing)}function xa(d,c,a){a.mask&&(a.autosave&&fa(d,c),d.clip(),c.transforms.masks.push(a._args))}function X(d,c,a){a.closed&&c.closePath();a.shadowStroke&&0!==a.strokeWidth?(c.stroke(),c.fill(),c.shadowColor="transparent",c.shadowBlur=0,c.stroke()):(c.fill(),"transparent"!==a.fillStyle&&(c.shadowColor="transparent"),0!==a.strokeWidth&&c.stroke());a.closed||c.closePath();a._transformed&&c.restore();
a.mask&&(d=F(d),xa(c,d,a))}function S(d,c,a,b,f){a._toRad=a.inDegrees?E/180:1;a._transformed=q;c.save();a.fromCenter||a._centered||b===v||(f===v&&(f=b),a.x+=b/2,a.y+=f/2,a._centered=q);a.rotate&&ya(c,a,h);1===a.scale&&1===a.scaleX&&1===a.scaleY||za(c,a,h);(a.translate||a.translateX||a.translateY)&&Aa(c,a,h)}function F(d){var c=ba.dataCache,a;c._canvas===d&&c._data?a=c._data:(a=g.data(d,"jCanvas"),a||(a={canvas:d,layers:[],layer:{names:{},groups:{}},eventHooks:{},intersecting:[],lastIntersected:h,
cursor:g(d).css("cursor"),drag:{layer:h,dragging:y},event:{type:h,x:h,y:h},events:{},transforms:ka(na),savedTransforms:[],animating:y,animated:h,pixelRatio:1,scaled:y},g.data(d,"jCanvas",a)),c._canvas=d,c._data=a);return a}function Ba(d,c,a){for(var b in $.events)$.events.hasOwnProperty(b)&&(a[b]||a.cursors&&a.cursors[b])&&Ca(d,c,a,b)}function Ca(d,c,a,b){$.events[b](d,c);a._event=q}function Da(d,c,a){var b,f,e;if(a.draggable||a.cursors){b=["mousedown","mousemove","mouseup"];for(e=0;e<b.length;e+=
1)f=b[e],Ca(d,c,a,f);c.events.mouseoutdrag||(d.bind("mouseout.jCanvas",function(){var a=c.drag.layer;a&&(c.drag={},Q(d,c,a,"dragcancel"),d.drawLayers())}),c.events.mouseoutdrag=q);a._event=q}}function oa(d,c,a,b){d=c.layer.names;b?b.name!==v&&ja(a.name)&&a.name!==b.name&&delete d[a.name]:b=a;ja(b.name)&&(d[b.name]=a)}function pa(d,c,a,b){d=c.layer.groups;var f,e,k,G;if(!b)b=a;else if(b.groups!==v&&a.groups!==h)for(e=0;e<a.groups.length;e+=1)if(f=a.groups[e],c=d[f]){for(G=0;G<c.length;G+=1)if(c[G]===
a){k=G;c.splice(G,1);break}0===c.length&&delete d[f]}if(b.groups!==v&&b.groups!==h)for(e=0;e<b.groups.length;e+=1)f=b.groups[e],c=d[f],c||(c=d[f]=[],c.name=f),k===v&&(k=c.length),c.splice(k,0,a)}function qa(d,c,a,b,f){b[a]&&c._running&&!c._running[a]&&(c._running[a]=q,b[a].call(d[0],c,f),c._running[a]=y)}function Q(d,c,a,b,f){if(!a.disableEvents){if("mouseout"!==b){var e;a.cursors&&(e=a.cursors[b]);-1!==g.inArray(e,W.cursors)&&(e=W.prefix+e);e&&d.css({cursor:e})}qa(d,a,b,a,f);qa(d,a,b,c.eventHooks,
f);qa(d,a,b,$.eventHooks,f)}}function P(d,c,a,b){var f,e=c._layer?a:c;c._args=a;if(c.draggable||c.dragGroups)c.layer=q,c.draggable=q;c._method=b?b:c.method?g.fn[c.method]:c.type?g.fn[Y.drawings[c.type]]:function(){};c.layer&&!c._layer&&(a=g(d),b=F(d),f=b.layers,e.name===h||ja(e.name)&&b.layer.names[e.name]===v)&&(e=new H(c),e.canvas=d,e.layer=q,e._layer=q,e._running={},e.data=e.data!==h?Z({},e.data):{},e.groups=e.groups!==h?e.groups.slice(0):[],oa(a,b,e),pa(a,b,e),Ba(a,b,e),Da(a,b,e),c._event=e._event,
e._method===g.fn.drawText&&a.measureText(e),e.index===h&&(e.index=f.length),f.splice(e.index,0,e),c._args=e,Q(a,b,e,"add"));return e}function Ea(d,c){var a,b;for(b=0;b<W.props.length;b+=1)a=W.props[b],d[a]!==v&&(d["_"+a]=d[a],W.propsObj[a]=q,c&&delete d[a])}function Sa(d,c,a){var b,f,e,k;for(b in a)if(a.hasOwnProperty(b)&&(f=a[b],da(f)&&(a[b]=f.call(d,c,b)),"object"===aa(f)&&Fa(f))){for(e in f)f.hasOwnProperty(e)&&(k=f[e],c[b]!==v&&(c[b+"."+e]=c[b][e],a[b+"."+e]=k));delete a[b]}return a}function Ga(d){var c,
a,b=[],f=1;d.match(/^([a-z]+|#[0-9a-f]+)$/gi)&&("transparent"===d&&(d="rgba( 0,0,0,0 )"),a=ua.head,c=a.style.color,a.style.color=d,d=g.css(a,"color"),a.style.color=c);d.match(/^rgb/gi)&&(b=d.match(/(\d+(\.\d+)?)/gi),d.match(/%/gi)&&(f=2.55),b[0]*=f,b[1]*=f,b[2]*=f,b[3]=b[3]!==v?ea(b[3]):1);return b}function Ta(d){var c=3,a;"array"!==aa(d.start)&&(d.start=Ga(d.start),d.end=Ga(d.end));d.now=[];if(1!==d.start[3]||1!==d.end[3])c=4;for(a=0;a<c;a+=1)d.now[a]=d.start[a]+(d.end[a]-d.start[a])*d.pos,3>a&&
(d.now[a]=Ua(d.now[a]));1!==d.start[3]||1!==d.end[3]?d.now="rgba( "+d.now.join(",")+" )":(d.now.slice(0,3),d.now="rgb( "+d.now.join(",")+" )");d.elem.nodeName?d.elem.style[d.prop]=d.now:d.elem[d.prop]=d.now}function Va(d){Y.touchEvents[d]&&(d=Y.touchEvents[d]);return d}function Wa(d){$.events[d]=function(c,a){function b(a){k.x=a.offsetX;k.y=a.offsetY;k.type=f;k.event=a;c.drawLayers({resetFire:q});a.preventDefault()}var f,e,k;k=a.event;f="mouseover"===d||"mouseout"===d?"mousemove":d;e=Va(f);a.events[f]||
(e!==f?c.bind(f+".jCanvas "+e+".jCanvas",b):c.bind(f+".jCanvas",b),a.events[f]=q)}}function U(d,c,a){var b,f,e,k;if(a=a._args)d=F(d),b=d.event,b.x!==h&&b.y!==h&&(e=b.x*d.pixelRatio,k=b.y*d.pixelRatio,f=!!(c.isPointInPath(e,k)||c.isPointInStroke&&c.isPointInStroke(e,k))),c=d.transforms,a.eventX=b.x,a.eventY=b.y,a.event=b.event,b=d.transforms.rotate,e=a.eventX,k=a.eventY,0!==b?(a._eventX=e*N(-b)-k*R(-b),a._eventY=k*N(-b)+e*R(-b)):(a._eventX=e,a._eventY=k),a._eventX/=c.scaleX,a._eventY/=c.scaleY,f&&
d.intersecting.push(a),a.intersects=!!f}function ya(d,c,a){c._toRad=c.inDegrees?E/180:1;d.translate(c.x,c.y);d.rotate(c.rotate*c._toRad);d.translate(-c.x,-c.y);a&&(a.rotate+=c.rotate*c._toRad)}function za(d,c,a){1!==c.scale&&(c.scaleX=c.scaleY=c.scale);d.translate(c.x,c.y);d.scale(c.scaleX,c.scaleY);d.translate(-c.x,-c.y);a&&(a.scaleX*=c.scaleX,a.scaleY*=c.scaleY)}function Aa(d,c,a){c.translate&&(c.translateX=c.translateY=c.translate);d.translate(c.translateX,c.translateY);a&&(a.translateX+=c.translateX,
a.translateY+=c.translateY)}function Ha(d){for(;0>d;)d+=2*E;return d}function Ia(d,c,a,b){var f,e,k,g,D,t,h;a===b?h=t=0:(t=a.x,h=a.y);b.inDegrees||360!==b.end||(b.end=2*E);b.start*=a._toRad;b.end*=a._toRad;b.start-=E/2;b.end-=E/2;D=E/180;b.ccw&&(D*=-1);f=b.x+b.radius*N(b.start+D);e=b.y+b.radius*R(b.start+D);k=b.x+b.radius*N(b.start);g=b.y+b.radius*R(b.start);ga(d,c,a,b,f,e,k,g);c.arc(b.x+t,b.y+h,b.radius,b.start,b.end,b.ccw);f=b.x+b.radius*N(b.end+D);D=b.y+b.radius*R(b.end+D);e=b.x+b.radius*N(b.end);
k=b.y+b.radius*R(b.end);ha(d,c,a,b,e,k,f,D)}function Ja(d,c,a,b,f,e,k,g){var D,t;b.arrowRadius&&!a.closed&&(t=Xa(g-e,k-f),t-=E,d=a.strokeWidth*N(t),D=a.strokeWidth*R(t),a=k+b.arrowRadius*N(t+b.arrowAngle/2),f=g+b.arrowRadius*R(t+b.arrowAngle/2),e=k+b.arrowRadius*N(t-b.arrowAngle/2),b=g+b.arrowRadius*R(t-b.arrowAngle/2),c.moveTo(a-d,f-D),c.lineTo(k-d,g-D),c.lineTo(e-d,b-D),c.moveTo(k-d,g-D),c.lineTo(k+d,g+D),c.moveTo(k,g))}function ga(d,c,a,b,f,e,k,g){b._arrowAngleConverted||(b.arrowAngle*=a._toRad,
b._arrowAngleConverted=q);b.startArrow&&Ja(d,c,a,b,f,e,k,g)}function ha(d,c,a,b,f,e,k,g){b._arrowAngleConverted||(b.arrowAngle*=a._toRad,b._arrowAngleConverted=q);b.endArrow&&Ja(d,c,a,b,f,e,k,g)}function Ka(d,c,a,b){var f,e,k;f=2;ga(d,c,a,b,b.x2+a.x,b.y2+a.y,b.x1+a.x,b.y1+a.y);for(b.x1!==v&&b.y1!==v&&c.moveTo(b.x1+a.x,b.y1+a.y);q;)if(e=b["x"+f],k=b["y"+f],e!==v&&k!==v)c.lineTo(e+a.x,k+a.y),f+=1;else break;f-=1;ha(d,c,a,b,b["x"+(f-1)]+a.x,b["y"+(f-1)]+a.y,b["x"+f]+a.x,b["y"+f]+a.y)}function La(d,c,
a,b){var f,e,k,g,D;f=2;ga(d,c,a,b,b.cx1+a.x,b.cy1+a.y,b.x1+a.x,b.y1+a.y);for(b.x1!==v&&b.y1!==v&&c.moveTo(b.x1+a.x,b.y1+a.y);q;)if(e=b["x"+f],k=b["y"+f],g=b["cx"+(f-1)],D=b["cy"+(f-1)],e!==v&&k!==v&&g!==v&&D!==v)c.quadraticCurveTo(g+a.x,D+a.y,e+a.x,k+a.y),f+=1;else break;f-=1;ha(d,c,a,b,b["cx"+(f-1)]+a.x,b["cy"+(f-1)]+a.y,b["x"+f]+a.x,b["y"+f]+a.y)}function Ma(d,c,a,b){var f,e,k,g,D,t,h,B;f=2;e=1;ga(d,c,a,b,b.cx1+a.x,b.cy1+a.y,b.x1+a.x,b.y1+a.y);for(b.x1!==v&&b.y1!==v&&c.moveTo(b.x1+a.x,b.y1+a.y);q;)if(k=
b["x"+f],g=b["y"+f],D=b["cx"+e],t=b["cy"+e],h=b["cx"+(e+1)],B=b["cy"+(e+1)],k!==v&&g!==v&&D!==v&&t!==v&&h!==v&&B!==v)c.bezierCurveTo(D+a.x,t+a.y,h+a.x,B+a.y,k+a.x,g+a.y),f+=1,e+=2;else break;f-=1;e-=2;ha(d,c,a,b,b["cx"+(e+1)]+a.x,b["cy"+(e+1)]+a.y,b["x"+f]+a.x,b["y"+f]+a.y)}function Na(d,c,a){c*=d._toRad;c-=E/2;return a*N(c)}function Oa(d,c,a){c*=d._toRad;c-=E/2;return a*R(c)}function Pa(d,c,a,b){var f,e,k,g,h,t,M;a===b?h=g=0:(g=a.x,h=a.y);f=1;e=g=t=b.x+g;k=h=M=b.y+h;ga(d,c,a,b,e+Na(a,b.a1,b.l1),
k+Oa(a,b.a1,b.l1),e,k);for(b.x!==v&&b.y!==v&&c.moveTo(e,k);q;)if(e=b["a"+f],k=b["l"+f],e!==v&&k!==v)g=t,h=M,t+=Na(a,e,k),M+=Oa(a,e,k),c.lineTo(t,M),f+=1;else break;ha(d,c,a,b,g,h,t,M)}function ra(d,c,a){isNaN(Number(a.fontSize))||(a.fontSize+="px");c.font=a.fontStyle+" "+a.fontSize+" "+a.fontFamily}function sa(d,c,a,b){var f,e;f=ba.propCache;if(f.text===a.text&&f.fontStyle===a.fontStyle&&f.fontSize===a.fontSize&&f.fontFamily===a.fontFamily&&f.maxWidth===a.maxWidth&&f.lineHeight===a.lineHeight)a.width=
f.width,a.height=f.height;else{a.width=c.measureText(b[0]).width;for(e=1;e<b.length;e+=1)f=c.measureText(b[e]).width,f>a.width&&(a.width=f);c=d.style.fontSize;d.style.fontSize=a.fontSize;a.height=ea(g.css(d,"fontSize"))*b.length*a.lineHeight;d.style.fontSize=c}}function Qa(d,c){var a=c.maxWidth,b=c.text.split("\n"),f=[],e,k,g,h,t;for(g=0;g<b.length;g+=1){h=b[g];t=h.split(" ");e=[];k="";if(1===t.length||d.measureText(h).width<a)e=[h];else{for(h=0;h<t.length;h+=1)d.measureText(k+t[h]).width>a&&(""!==
k&&e.push(k),k=""),k+=t[h],h!==t.length-1&&(k+=" ");e.push(k)}f=f.concat(e.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n"))}return f}var la,Z=g.extend,ia=g.inArray,aa=g.type,da=g.isFunction,Fa=g.isPlainObject,E=ca.PI,Ua=ca.round,Ya=ca.abs,R=ca.sin,N=ca.cos,Xa=ca.atan2,ta=Ra.prototype.slice,Za=g.event.fix,Y={},ba={dataCache:{},propCache:{},imageCache:{}},na={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},W={},$={events:{},eventHooks:{},future:{}};ma.baseDefaults={align:"center",
arrowAngle:90,arrowRadius:0,autosave:q,baseline:"middle",bringToFront:y,ccw:y,closed:y,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:q,crossOrigin:"",cursors:h,disableEvents:y,draggable:y,dragGroups:h,groups:h,data:h,dx:h,dy:h,end:360,eventX:h,eventY:h,fillStyle:"transparent",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:q,height:h,imageSmoothing:q,inDegrees:q,index:h,letterSpacing:h,lineHeight:1,layer:y,mask:y,maxWidth:h,miterLimit:10,name:h,
opacity:1,r1:h,r2:h,radius:0,repeat:"repeat",respectAlign:y,rotate:0,rounded:y,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:y,shadowX:0,shadowY:0,sHeight:h,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeDash:h,strokeDashOffset:0,strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:h,sx:h,sy:h,text:"",translate:0,translateX:0,translateY:0,type:h,visible:q,width:h,x:0,y:0};la=new ma;H.prototype=la;$.extend=function(d){d.name&&(d.props&&Z(la,d.props),
g.fn[d.name]=function a(b){var f,e,k,g;for(e=0;e<this.length;e+=1)if(f=this[e],k=L(f))g=new H(b),P(f,g,b,a),T(f,k,g),d.fn.call(f,k,g);return this},d.type&&(Y.drawings[d.type]=d.name));return g.fn[d.name]};g.fn.getEventHooks=function(){var d;d={};0!==this.length&&(d=this[0],d=F(d),d=d.eventHooks);return d};g.fn.setEventHooks=function(d){var c,a;for(c=0;c<this.length;c+=1)g(this[c]),a=F(this[c]),Z(a.eventHooks,d);return this};g.fn.getLayers=function(d){var c,a,b,f,e=[];if(0!==this.length)if(c=this[0],
a=F(c),a=a.layers,da(d))for(f=0;f<a.length;f+=1)b=a[f],d.call(c,b)&&e.push(b);else e=a;return e};g.fn.getLayer=function(d){var c,a,b,f;if(0!==this.length)if(c=this[0],a=F(c),c=a.layers,f=aa(d),d&&d.layer)b=d;else if("number"===f)0>d&&(d=c.length+d),b=c[d];else if("regexp"===f)for(a=0;a<c.length;a+=1){if(ja(c[a].name)&&c[a].name.match(d)){b=c[a];break}}else b=a.layer.names[d];return b};g.fn.getLayerGroup=function(d){var c,a,b,f=aa(d);if(0!==this.length)if(c=this[0],"array"===f)b=d;else if("regexp"===
f)for(a in c=F(c),c=c.layer.groups,c){if(a.match(d)){b=c[a];break}}else c=F(c),b=c.layer.groups[d];return b};g.fn.getLayerIndex=function(d){var c=this.getLayers();d=this.getLayer(d);return ia(d,c)};g.fn.setLayer=function(d,c){var a,b,f,e,k,h,D;for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=F(this[b]),e=g(this[b]).getLayer(d)){oa(a,f,e,c);pa(a,f,e,c);for(k in c)c.hasOwnProperty(k)&&(h=c[k],D=aa(h),"object"===D&&Fa(h)?e[k]=Z({},h):"array"===D?e[k]=h.slice(0):"string"===D?0===h.indexOf("+=")?e[k]+=ea(h.substr(2)):
0===h.indexOf("-=")?e[k]-=ea(h.substr(2)):e[k]=h:e[k]=h);Ba(a,f,e);Da(a,f,e);g.isEmptyObject(c)===y&&Q(a,f,e,"change",c)}return this};g.fn.setLayers=function(d,c){var a,b,f,e;for(b=0;b<this.length;b+=1)for(a=g(this[b]),f=a.getLayers(c),e=0;e<f.length;e+=1)a.setLayer(f[e],d);return this};g.fn.setLayerGroup=function(d,c){var a,b,f,e;for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=a.getLayerGroup(d))for(e=0;e<f.length;e+=1)a.setLayer(f[e],c);return this};g.fn.moveLayer=function(d,c){var a,b,f,e,k;for(b=
0;b<this.length;b+=1)if(a=g(this[b]),f=F(this[b]),e=f.layers,k=a.getLayer(d))k.index=ia(k,e),e.splice(k.index,1),e.splice(c,0,k),0>c&&(c=e.length+c),k.index=c,Q(a,f,k,"move");return this};g.fn.removeLayer=function(d){var c,a,b,f,e;for(a=0;a<this.length;a+=1)if(c=g(this[a]),b=F(this[a]),f=c.getLayers(),e=c.getLayer(d))e.index=ia(e,f),f.splice(e.index,1),oa(c,b,e,{name:h}),pa(c,b,e,{groups:h}),Q(c,b,e,"remove");return this};g.fn.removeLayers=function(d){var c,a,b,f,e,k;for(a=0;a<this.length;a+=1){c=
g(this[a]);b=F(this[a]);f=c.getLayers(d);for(k=0;k<f.length;k+=1)e=f[k],c.removeLayer(e),k-=1;b.layer.names={};b.layer.groups={}}return this};g.fn.removeLayerGroup=function(d){var c,a,b,f;if(d!==v)for(a=0;a<this.length;a+=1)if(c=g(this[a]),F(this[a]),c.getLayers(),b=c.getLayerGroup(d))for(b=b.slice(0),f=0;f<b.length;f+=1)c.removeLayer(b[f]);return this};g.fn.addLayerToGroup=function(d,c){var a,b,f,e=[c];for(b=0;b<this.length;b+=1)a=g(this[b]),f=a.getLayer(d),f.groups&&(e=f.groups.slice(0),-1===ia(c,
f.groups)&&e.push(c)),a.setLayer(f,{groups:e});return this};g.fn.removeLayerFromGroup=function(d,c){var a,b,f,e=[],k;for(b=0;b<this.length;b+=1)a=g(this[b]),f=a.getLayer(d),f.groups&&(k=ia(c,f.groups),-1!==k&&(e=f.groups.slice(0),e.splice(k,1),a.setLayer(f,{groups:e})));return this};W.cursors=["grab","grabbing","zoom-in","zoom-out"];W.prefix=function(){var d=getComputedStyle(ua.documentElement,"");return"-"+(ta.call(d).join("").match(/-(moz|webkit|ms)-/)||""===d.OLink&&["","o"])[1]+"-"}();g.fn.triggerLayerEvent=
function(d,c){var a,b,f;for(b=0;b<this.length;b+=1)a=g(this[b]),f=F(this[b]),(d=a.getLayer(d))&&Q(a,f,d,c);return this};g.fn.drawLayer=function(d){var c,a,b;for(c=0;c<this.length;c+=1)a=g(this[c]),L(this[c]),(b=a.getLayer(d))&&b.visible&&b._method&&(b._next=h,b._method.call(a,b));return this};g.fn.drawLayers=function(d){var c,a,b=Z({},d),f,e,k,G,D,t,M;b.index||(b.index=0);for(c=0;c<this.length;c+=1)if(d=g(this[c]),a=L(this[c])){G=F(this[c]);b.clear!==y&&d.clearCanvas();a=G.layers;for(k=b.index;k<
a.length;k+=1)if(f=a[k],f.index=k,b.resetFire&&(f._fired=y),D=d,t=f,e=k+1,t&&t.visible&&t._method&&(t._next=e?e:h,t._method.call(D,t)),f._masks=G.transforms.masks.slice(0),f._method===g.fn.drawImage&&f.visible){M=!0;break}if(M)break;f=G;var B=e=t=D=void 0;D=h;for(t=f.intersecting.length-1;0<=t;t-=1)if(D=f.intersecting[t],D._masks){for(B=D._masks.length-1;0<=B;B-=1)if(e=D._masks[B],!e.intersects){D.intersects=y;break}if(D.intersects)break}f=D;D=G.event;t=D.type;if(G.drag.layer){e=d;var B=G,z=t,A=void 0,
m=void 0,u=void 0,p=u=void 0,x=void 0,u=A=A=u=void 0,u=B.drag,p=(m=u.layer)&&m.dragGroups||[],A=B.layers;if("mousemove"===z||"touchmove"===z){if(u.dragging||(u.dragging=q,m.dragging=q,m.bringToFront&&(A.splice(m.index,1),m.index=A.push(m)),m._startX=m.x,m._startY=m.y,m._endX=m._eventX,m._endY=m._eventY,Q(e,B,m,"dragstart")),u.dragging)for(A=m._eventX-(m._endX-m._startX),u=m._eventY-(m._endY-m._startY),m.dx=A-m.x,m.dy=u-m.y,m.x=A,m.y=u,Q(e,B,m,"drag"),A=0;A<p.length;A+=1)if(u=p[A],x=B.layer.groups[u],
m.groups&&x)for(u=0;u<x.length;u+=1)x[u]!==m&&(x[u].x+=m.dx,x[u].y+=m.dy)}else if("mouseup"===z||"touchend"===z)u.dragging&&(m.dragging=y,u.dragging=y,Q(e,B,m,"dragstop")),B.drag={}}e=G.lastIntersected;e===h||f===e||!e._hovered||e._fired||G.drag.dragging||(G.lastIntersected=h,e._fired=q,e._hovered=y,Q(d,G,e,"mouseout"),d.css({cursor:G.cursor}));f&&(f[t]||Y.mouseEvents[t]&&(t=Y.mouseEvents[t]),f._event&&f.intersects&&(G.lastIntersected=f,!(f.mouseover||f.mouseout||f.cursors)||G.drag.dragging||f._hovered||
f._fired||(f._fired=q,f._hovered=q,Q(d,G,f,"mouseover")),f._fired||(f._fired=q,D.type=h,Q(d,G,f,t)),!f.draggable||f.disableEvents||"mousedown"!==t&&"touchstart"!==t||(G.drag.layer=f)));f!==h||G.drag.dragging||d.css({cursor:G.cursor});k===a.length&&(G.intersecting.length=0,G.transforms=ka(na),G.savedTransforms.length=0)}return this};g.fn.addLayer=function(d){var c,a;for(c=0;c<this.length;c+=1)if(a=L(this[c]))a=new H(d),a.layer=q,P(this[c],a,d);return this};W.props=["width","height","opacity","lineHeight"];
W.propsObj={};g.fn.animateLayer=function(){function d(a,b,c){return function(){var d,f;for(f=0;f<W.props.length;f+=1)d=W.props[f],c[d]=c["_"+d];for(var k in c)c.hasOwnProperty(k)&&-1!==k.indexOf(".")&&delete c[k];b.animating&&b.animated!==c||a.drawLayers();c._animating=y;b.animating=y;b.animated=h;e[4]&&e[4].call(a[0],c);Q(a,b,c,"animateend")}}function c(a,b,c){return function(d,f){var k,g,h=!1;"_"===f.prop[0]&&(h=!0,f.prop=f.prop.replace("_",""),c[f.prop]=c["_"+f.prop]);-1!==f.prop.indexOf(".")&&
(k=f.prop.split("."),g=k[0],k=k[1],c[g]&&(c[g][k]=f.now));c._pos!==f.pos&&(c._pos=f.pos,c._animating||b.animating||(c._animating=q,b.animating=q,b.animated=c),b.animating&&b.animated!==c||a.drawLayers());e[5]&&e[5].call(a[0],d,f,c);Q(a,b,c,"animate",f);h&&(f.prop="_"+f.prop)}}var a,b,f,e=ta.call(arguments,0),k,G;"object"===aa(e[2])?(e.splice(2,0,e[2].duration||h),e.splice(3,0,e[3].easing||h),e.splice(4,0,e[4].complete||h),e.splice(5,0,e[5].step||h)):(e[2]===v?(e.splice(2,0,h),e.splice(3,0,h),e.splice(4,
0,h)):da(e[2])&&(e.splice(2,0,h),e.splice(3,0,h)),e[3]===v?(e[3]=h,e.splice(4,0,h)):da(e[3])&&e.splice(3,0,h));for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=L(this[b]))f=F(this[b]),(k=a.getLayer(e[0]))&&k._method!==g.fn.draw&&(G=Z({},e[1]),G=Sa(this[b],k,G),Ea(G,q),Ea(k),k.style=W.propsObj,g(k).animate(G,{duration:e[2],easing:g.easing[e[3]]?e[3]:h,complete:d(a,f,k),step:c(a,f,k)}),Q(a,f,k,"animatestart"));return this};g.fn.animateLayerGroup=function(d){var c,a,b=ta.call(arguments,0),f,e;for(a=0;a<
this.length;a+=1)if(c=g(this[a]),f=c.getLayerGroup(d))for(e=0;e<f.length;e+=1)b[0]=f[e],c.animateLayer.apply(c,b);return this};g.fn.delayLayer=function(d,c){var a,b,f,e;c=c||0;for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=F(this[b]),e=a.getLayer(d))g(e).delay(c),Q(a,f,e,"delay");return this};g.fn.delayLayerGroup=function(d,c){var a,b,f,e,k;c=c||0;for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=a.getLayerGroup(d))for(k=0;k<f.length;k+=1)e=f[k],a.delayLayer(e,c);return this};g.fn.stopLayer=function(d,c){var a,
b,f,e;for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=F(this[b]),e=a.getLayer(d))g(e).stop(c),Q(a,f,e,"stop");return this};g.fn.stopLayerGroup=function(d,c){var a,b,f,e,k;for(b=0;b<this.length;b+=1)if(a=g(this[b]),f=a.getLayerGroup(d))for(k=0;k<f.length;k+=1)e=f[k],a.stopLayer(e,c);return this};(function(d){var c;for(c=0;c<d.length;c+=1)g.fx.step[d[c]]=Ta})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
Y.touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};Y.mouseEvents={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};(function(d){var c;for(c=0;c<d.length;c+=1)Wa(d[c])})("click dblclick mousedown mouseup mousemove mouseover mouseout touchstart touchmove touchend".split(" "));g.event.fix=function(d){var c,a;d=Za.call(g.event,d);if(c=d.originalEvent)if(a=c.changedTouches,d.pageX!==v&&d.offsetX===v){if(c=g(d.currentTarget).offset())d.offsetX=d.pageX-c.left,
d.offsetY=d.pageY-c.top}else a&&(c=g(d.currentTarget).offset())&&(d.offsetX=a[0].pageX-c.left,d.offsetY=a[0].pageY-c.top);return d};Y.drawings={arc:"drawArc",bezier:"drawBezier",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",path:"drawPath",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector",save:"saveCanvas",restore:"restoreCanvas",rotate:"rotateCanvas",scale:"scaleCanvas",translate:"translateCanvas"};
g.fn.draw=function c(a){var b,f,e=new H(a);if(Y.drawings[e.type]&&"function"!==e.type)this[Y.drawings[e.type]](a);else for(b=0;b<this.length;b+=1)if(g(this[b]),f=L(this[b]))e=new H(a),P(this[b],e,a,c),e.visible&&e.fn&&e.fn.call(this[b],f,e);return this};g.fn.clearCanvas=function a(b){var f,e,k=new H(b);for(f=0;f<this.length;f+=1)if(e=L(this[f]))k.width===h||k.height===h?(e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this[f].width,this[f].height),e.restore()):(P(this[f],k,b,a),S(this[f],e,k,
k.width,k.height),e.clearRect(k.x-k.width/2,k.y-k.height/2,k.width,k.height),k._transformed&&e.restore());return this};g.fn.saveCanvas=function b(f){var e,k,g,h,t;for(e=0;e<this.length;e+=1)if(k=L(this[e]))for(h=F(this[e]),g=new H(f),P(this[e],g,f,b),t=0;t<g.count;t+=1)fa(k,h);return this};g.fn.restoreCanvas=function f(e){var k,g,h,t,M;for(k=0;k<this.length;k+=1)if(g=L(this[k]))for(t=F(this[k]),h=new H(e),P(this[k],h,e,f),M=0;M<h.count;M+=1){var B=g,z=t;0===z.savedTransforms.length?z.transforms=ka(na):
(B.restore(),z.transforms=z.savedTransforms.pop())}return this};g.fn.rotateCanvas=function e(k){var g,h,t,M;for(g=0;g<this.length;g+=1)if(h=L(this[g]))M=F(this[g]),t=new H(k),P(this[g],t,k,e),t.autosave&&fa(h,M),ya(h,t,M.transforms);return this};g.fn.scaleCanvas=function k(g){var h,t,M,B;for(h=0;h<this.length;h+=1)if(t=L(this[h]))B=F(this[h]),M=new H(g),P(this[h],M,g,k),M.autosave&&fa(t,B),za(t,M,B.transforms);return this};g.fn.translateCanvas=function G(g){var h,M,B,z;for(h=0;h<this.length;h+=1)if(M=
L(this[h]))z=F(this[h]),B=new H(g),P(this[h],B,g,G),B.autosave&&fa(M,z),Aa(M,B,z.transforms);return this};g.fn.drawRect=function D(g){var h,B,z,A,m,u,p,x,K;for(h=0;h<this.length;h+=1)if(B=L(this[h]))z=new H(g),P(this[h],z,g,D),z.visible&&(T(this[h],B,z),S(this[h],B,z,z.width,z.height),B.beginPath(),z.width&&z.height&&(A=z.x-z.width/2,m=z.y-z.height/2,(x=Ya(z.cornerRadius))?(u=z.x+z.width/2,p=z.y+z.height/2,0>z.width&&(K=A,A=u,u=K),0>z.height&&(K=m,m=p,p=K),0>u-A-2*x&&(x=(u-A)/2),0>p-m-2*x&&(x=(p-
m)/2),B.moveTo(A+x,m),B.lineTo(u-x,m),B.arc(u-x,m+x,x,3*E/2,2*E,y),B.lineTo(u,p-x),B.arc(u-x,p-x,x,0,E/2,y),B.lineTo(A+x,p),B.arc(A+x,p-x,x,E/2,E,y),B.lineTo(A,m+x),B.arc(A+x,m+x,x,E,3*E/2,y),z.closed=q):B.rect(A,m,z.width,z.height)),U(this[h],B,z),X(this[h],B,z));return this};g.fn.drawArc=function t(g){var h,z,A;for(h=0;h<this.length;h+=1)if(z=L(this[h]))A=new H(g),P(this[h],A,g,t),A.visible&&(T(this[h],z,A),S(this[h],z,A,2*A.radius),z.beginPath(),Ia(this[h],z,A,A),U(this[h],z,A),X(this[h],z,A));
return this};g.fn.drawEllipse=function M(g){var h,A,m,u,p;for(h=0;h<this.length;h+=1)if(A=L(this[h]))m=new H(g),P(this[h],m,g,M),m.visible&&(T(this[h],A,m),S(this[h],A,m,m.width,m.height),u=4/3*m.width,p=m.height,A.beginPath(),A.moveTo(m.x,m.y-p/2),A.bezierCurveTo(m.x-u/2,m.y-p/2,m.x-u/2,m.y+p/2,m.x,m.y+p/2),A.bezierCurveTo(m.x+u/2,m.y+p/2,m.x+u/2,m.y-p/2,m.x,m.y-p/2),U(this[h],A,m),m.closed=q,X(this[h],A,m));return this};g.fn.drawPolygon=function B(h){var g,m,u,p,x,K,I,w,n,l;for(g=0;g<this.length;g+=
1)if(m=L(this[g]))if(u=new H(h),P(this[g],u,h,B),u.visible){T(this[g],m,u);S(this[g],m,u,2*u.radius);x=2*E/u.sides;K=x/2;p=K+E/2;I=u.radius*N(K);m.beginPath();for(l=0;l<u.sides;l+=1)w=u.x+u.radius*N(p),n=u.y+u.radius*R(p),m.lineTo(w,n),u.concavity&&(w=u.x+(I+-I*u.concavity)*N(p+K),n=u.y+(I+-I*u.concavity)*R(p+K),m.lineTo(w,n)),p+=x;U(this[g],m,u);u.closed=q;X(this[g],m,u)}return this};g.fn.drawSlice=function z(h){var m,u,p,x,K;for(m=0;m<this.length;m+=1)if(g(this[m]),u=L(this[m]))p=new H(h),P(this[m],
p,h,z),p.visible&&(T(this[m],u,p),S(this[m],u,p,2*p.radius),p.start*=p._toRad,p.end*=p._toRad,p.start-=E/2,p.end-=E/2,p.start=Ha(p.start),p.end=Ha(p.end),p.end<p.start&&(p.end+=2*E),x=(p.start+p.end)/2,K=p.radius*p.spread*N(x),x=p.radius*p.spread*R(x),p.x+=K,p.y+=x,u.beginPath(),u.arc(p.x,p.y,p.radius,p.start,p.end,p.ccw),u.lineTo(p.x,p.y),U(this[m],u,p),p.closed=q,X(this[m],u,p));return this};g.fn.drawLine=function A(h){var g,p,x;for(g=0;g<this.length;g+=1)if(p=L(this[g]))x=new H(h),P(this[g],x,
h,A),x.visible&&(T(this[g],p,x),S(this[g],p,x),p.beginPath(),Ka(this[g],p,x,x),U(this[g],p,x),X(this[g],p,x));return this};g.fn.drawQuadratic=function m(g){var h,x,K;for(h=0;h<this.length;h+=1)if(x=L(this[h]))K=new H(g),P(this[h],K,g,m),K.visible&&(T(this[h],x,K),S(this[h],x,K),x.beginPath(),La(this[h],x,K,K),U(this[h],x,K),X(this[h],x,K));return this};g.fn.drawBezier=function u(h){var g,K,I;for(g=0;g<this.length;g+=1)if(K=L(this[g]))I=new H(h),P(this[g],I,h,u),I.visible&&(T(this[g],K,I),S(this[g],
K,I),K.beginPath(),Ma(this[g],K,I,I),U(this[g],K,I),X(this[g],K,I));return this};g.fn.drawVector=function p(g){var h,I,w;for(h=0;h<this.length;h+=1)if(I=L(this[h]))w=new H(g),P(this[h],w,g,p),w.visible&&(T(this[h],I,w),S(this[h],I,w),I.beginPath(),Pa(this[h],I,w,w),U(this[h],I,w),X(this[h],I,w));return this};g.fn.drawPath=function x(h){var g,w,n,l,C;for(g=0;g<this.length;g+=1)if(w=L(this[g]))if(n=new H(h),P(this[g],n,h,x),n.visible){T(this[g],w,n);S(this[g],w,n);w.beginPath();for(l=1;q;)if(C=n["p"+
l],C!==v)C=new H(C),"line"===C.type?Ka(this[g],w,n,C):"quadratic"===C.type?La(this[g],w,n,C):"bezier"===C.type?Ma(this[g],w,n,C):"vector"===C.type?Pa(this[g],w,n,C):"arc"===C.type&&Ia(this[g],w,n,C),l+=1;else break;U(this[g],w,n);X(this[g],w,n)}return this};g.fn.drawText=function K(I){var w,n,l,C,V,s,O,q,v,y;for(w=0;w<this.length;w+=1)if(g(this[w]),n=L(this[w]))if(l=new H(I),C=P(this[w],l,I,K),l.visible){T(this[w],n,l);n.textBaseline=l.baseline;n.textAlign=l.align;ra(this[w],n,l);V=l.maxWidth!==h?
Qa(n,l):l.text.toString().split("\n");sa(this[w],n,l,V);C&&(C.width=l.width,C.height=l.height);S(this[w],n,l,l.width,l.height);O=l.x;"left"===l.align?l.respectAlign?l.x+=l.width/2:O-=l.width/2:"right"===l.align&&(l.respectAlign?l.x-=l.width/2:O+=l.width/2);if(l.radius)for(O=ea(l.fontSize),l.letterSpacing===h&&(l.letterSpacing=O/500),s=0;s<V.length;s+=1){n.save();n.translate(l.x,l.y);C=V[s];q=C.length;n.rotate(-(E*l.letterSpacing*(q-1))/2);for(y=0;y<q;y+=1)v=C[y],0!==y&&n.rotate(E*l.letterSpacing),
n.save(),n.translate(0,-l.radius),n.fillText(v,0,0),n.restore();l.radius-=O;l.letterSpacing+=O/(1E3*E);n.restore()}else for(s=0;s<V.length;s+=1)C=V[s],q=l.y+s*l.height/V.length-(V.length-1)*l.height/V.length/2,n.shadowColor=l.shadowColor,n.fillText(C,O,q),"transparent"!==l.fillStyle&&(n.shadowColor="transparent"),0!==l.strokeWidth&&n.strokeText(C,O,q);q=0;"top"===l.baseline?q+=l.height/2:"bottom"===l.baseline&&(q-=l.height/2);l._event&&(n.beginPath(),n.rect(l.x-l.width/2,l.y-l.height/2+q,l.width,
l.height),U(this[w],n,l),n.closePath());l._transformed&&n.restore()}ba.propCache=l;return this};g.fn.measureText=function(g){var h,w;h=this.getLayer(g);if(!h||h&&!h._layer)h=new H(g);if(g=L(this[0]))ra(this[0],g,h),w=Qa(g,h),sa(this[0],g,h,w);return h};g.fn.drawImage=function I(w){function n(l,n,s,r,w){return function(){var C=g(l);T(l,n,r);r.width===h&&r.sWidth===h&&(r.width=r.sWidth=J.width);r.height===h&&r.sHeight===h&&(r.height=r.sHeight=J.height);w&&(w.width=r.width,w.height=r.height);r.sWidth!==
h&&r.sHeight!==h&&r.sx!==h&&r.sy!==h?(r.width===h&&(r.width=r.sWidth),r.height===h&&(r.height=r.sHeight),r.cropFromCenter&&(r.sx+=r.sWidth/2,r.sy+=r.sHeight/2),0>r.sy-r.sHeight/2&&(r.sy=r.sHeight/2),r.sy+r.sHeight/2>J.height&&(r.sy=J.height-r.sHeight/2),0>r.sx-r.sWidth/2&&(r.sx=r.sWidth/2),r.sx+r.sWidth/2>J.width&&(r.sx=J.width-r.sWidth/2),S(l,n,r,r.width,r.height),n.drawImage(J,r.sx-r.sWidth/2,r.sy-r.sHeight/2,r.sWidth,r.sHeight,r.x-r.width/2,r.y-r.height/2,r.width,r.height)):(S(l,n,r,r.width,r.height),
n.drawImage(J,r.x-r.width/2,r.y-r.height/2,r.width,r.height));n.beginPath();n.rect(r.x-r.width/2,r.y-r.height/2,r.width,r.height);U(l,n,r);n.closePath();r._transformed&&n.restore();xa(n,s,r);r.layer?Q(C,s,w,"load"):r.load&&r.load.call(C[0],w);r.layer&&(w._masks=s.transforms.masks.slice(0),r._next&&C.drawLayers({clear:y,resetFire:q,index:r._next}))}}var l,C,V,s,O,v,J,E,N,R=ba.imageCache;for(C=0;C<this.length;C+=1)if(l=this[C],V=L(this[C]))s=F(this[C]),O=new H(w),v=P(this[C],O,w,I),O.visible&&(N=O.source,
E=N.getContext,N.src||E?J=N:N&&(R[N]&&R[N].complete?J=R[N]:(J=new va,J.crossOrigin=O.crossOrigin,J.src=N,R[N]=J)),J&&(J.complete||E?n(l,V,s,O,v)():(J.onload=n(l,V,s,O,v),J.src=J.src)));return this};g.fn.createPattern=function(I){function w(){s=l.createPattern(q,C.repeat);C.load&&C.load.call(n[0],s)}var n=this,l,C,q,s,v;(l=L(n[0]))?(C=new H(I),v=C.source,da(v)?(q=g("<canvas />")[0],q.width=C.width,q.height=C.height,I=L(q),v.call(q,I),w()):(I=v.getContext,v.src||I?q=v:(q=new va,q.crossOrigin=C.crossOrigin,
q.src=v),q.complete||I?w():(q.onload=w(),q.src=q.src))):s=h;return s};g.fn.createGradient=function(g){var w,n=[],l,q,y,s,O,E,J;g=new H(g);if(w=L(this[0])){g.x1=g.x1||0;g.y1=g.y1||0;g.x2=g.x2||0;g.y2=g.y2||0;w=g.r1!==h&&g.r2!==h?w.createRadialGradient(g.x1,g.y1,g.r1,g.x2,g.y2,g.r2):w.createLinearGradient(g.x1,g.y1,g.x2,g.y2);for(s=1;g["c"+s]!==v;s+=1)g["s"+s]!==v?n.push(g["s"+s]):n.push(h);l=n.length;n[0]===h&&(n[0]=0);n[l-1]===h&&(n[l-1]=1);for(s=0;s<l;s+=1){if(n[s]!==h){E=1;J=0;q=n[s];for(O=s+1;O<
l;O+=1)if(n[O]!==h){y=n[O];break}else E+=1;q>y&&(n[O]=n[s])}else n[s]===h&&(J+=1,n[s]=q+(y-q)/E*J);w.addColorStop(n[s],g["c"+(s+1)])}}else w=h;return w};g.fn.setPixels=function w(g){var l,q,v,s,y,E,J,F,N;for(q=0;q<this.length;q+=1)if(l=this[q],v=L(l)){s=new H(g);P(l,s,g,w);S(this[q],v,s,s.width,s.height);if(s.width===h||s.height===h)s.width=l.width,s.height=l.height,s.x=s.width/2,s.y=s.height/2;if(0!==s.width&&0!==s.height){E=v.getImageData(s.x-s.width/2,s.y-s.height/2,s.width,s.height);J=E.data;
N=J.length;if(s.each)for(F=0;F<N;F+=4)y={r:J[F],g:J[F+1],b:J[F+2],a:J[F+3]},s.each.call(l,y,s),J[F]=y.r,J[F+1]=y.g,J[F+2]=y.b,J[F+3]=y.a;v.putImageData(E,s.x-s.width/2,s.y-s.height/2);v.restore()}}return this};g.fn.getCanvasImage=function(g,n){var l,q=h;0!==this.length&&(l=this[0],l.toDataURL&&(n===v&&(n=1),q=l.toDataURL("image/"+g,n)));return q};g.fn.detectPixelRatio=function(h){var n,l,v,y,s,E,H;for(l=0;l<this.length;l+=1)n=this[l],g(this[l]),v=L(n),H=F(this[l]),H.scaled||(y=window.devicePixelRatio||
1,s=v.webkitBackingStorePixelRatio||v.mozBackingStorePixelRatio||v.msBackingStorePixelRatio||v.oBackingStorePixelRatio||v.backingStorePixelRatio||1,y/=s,1!==y&&(s=n.width,E=n.height,n.width=s*y,n.height=E*y,n.style.width=s+"px",n.style.height=E+"px",v.scale(y,y)),H.pixelRatio=y,H.scaled=q,h&&h.call(n,y));return this};$.clearCache=function(){for(var g in ba)ba.hasOwnProperty(g)&&(ba[g]={})};g.support.canvas=g("<canvas />")[0].getContext!==v;Z($,{defaults:la,prefs:void 0,setGlobalProps:T,transformShape:S,
detectEvents:U,closePath:X,setCanvasFont:ra,measureText:sa});g.jCanvas=$;g.jCanvasObject=H})(jQuery,document,Image,Array,Math,parseFloat,window.console,!0,!1,null);

/*
  Abactus 2014
  File generated on Thu Jun 19 23:01:51 CEST 2014
*/
function openBoxinfo(a,c,b){$(document).off("click","#boxinfo");$(document).off("click","#boxinfo .cadre");$(document).on("click","#boxinfo",function(d){if(getBoxinfoStatus){if(b){closeBoxinfo()}}});$(document).on("click","#boxinfo .cadre",function(d){d.stopPropagation()});$(".pagecover").css("display","block");$(".pagecover").css("opacity","0");$.ajax({url:window.siteUrl+"views/game/"+a+".html",cache:false,async:false,success:function(d){$("#boxinfo").html(tplawesome(d,c))}});$("#boxinfo").css("display","block");sto=setTimeout("displayBoxinfo()",100)}function displayBoxinfo(){$("#boxinfo").css("opacity","1.0");$(".pagecover").css("opacity","0.4");$("#boxinfo .cadre").css("marginTop","100px")}function closeBoxinfo(){$("#boxinfo").html("");$(".pagecover").css("opacity","0");$("#boxinfo").css("opacity","0.1");$("#boxinfo").css("display","none");stout=setTimeout("$('.pagecover').css('display', 'none')",1000)}function getBoxinfoStatus(){return($("#boxinfo").html()=="")};function initChat(){$("#game").after('<div id="chatboxes_container"></div>');$("#game").after('<div id="chat_container"><div class="chat_trigger"><span class="txt"><<</span></div><div class="chat_list"></div></div>');$(document).on("click",".chat_minimize",function(){var a=$(this).parent().parent();if(!$(a).hasClass("minimized")){$(a).removeClass("notify");$(a).addClass("minimized")}else{$(a).addClass("notify");$(a).removeClass("minimized");$(a).find(".chat_input").focus()}});$(document).on("click",".chat_trigger",function(){if($(this).parent().hasClass("opened")){$(this).html('<span class="txt"><<</span>');$("#chatboxes_container").removeClass("shift");$(this).parent().removeClass("opened");$(this).parent().removeClass("stop")}else{$(this).html('<span class="txt">>></span>');$("#chatboxes_container").addClass("shift");$(this).parent().addClass("opened");$(this).parent().addClass("stop")}});$(document).on("click",".chat_send",function(){$(this).parent().submit()});$(document).on("submit",".chat_write",function(a){a.preventDefault();id=$(this).parent().attr("id");sendMessage(escape($(this).find(".chat_input").val()),id.replace("chatbox_",""));$(this).find(".chat_input").val("")});$(document).on("click","#chat_container .item",function(){var a=$(this).find(".pseudo").html();openNewChatBox(a,"chatbox_"+a)})}function destroyChatBox(a){if($("#"+a).length&&a.indexOf("chatbox_")>-1){$("#"+a).remove()}}function openNewChatBox(a,b){if(!$("#"+b).length&&b!="chatbox_"+window.pseudo){$.ajax({url:"../../views/game/chat.html",cache:false,async:false,success:function(c){$("#chatboxes_container").append(tplawesome(c,[{id:b,title:a}]))}})}$("#"+b).addClass("notify");$("#"+b).removeClass("minimized");$("#"+b).find(".chat_input").focus()}function sendMessage(a,b){if($.trim(a)!=""){sendData('{"type":"chatMessage","target":"'+b+'","message":"'+a+'","clientId":"'+window.clientId+'"}');if(b!="all"&&b!="team"){receiveMessage(JSON.parse('{"message": "'+a+'", "target": "'+b+'", "clientSource": "moi", "type": "chatMessage"}'))}}}function receiveMessage(b){if(b.clientSource!=window.pseudo&&b.clientSource!="moi"){playSound("chat")}if(b.target=="team"||b.target=="all"||b.clientSource=="moi"||b.clientSource=="invite"){var e=b.target}else{var e=b.clientSource}var a=$("#chatbox_"+e);if(!a.length>0){openNewChatBox(e,"chatbox_"+e);receiveMessage(b)}else{var d=a.find(".chat_messages");var c=$("<div>"+unescape(b.message)+"</div>");if(b.clientSource=="server"||b.clientSource=="invite"){d.append('<div class="chat_item server_notification">'+b.message+"</div>")}else{d.append('<div class="chat_item"><strong>'+b.clientSource+"</strong> "+c.text()+"</div>")}d.scrollTop(d.prop("scrollHeight"));if(b.clientSource!=window.pseudo&&b.clientSource!="moi"){a.addClass("notify")}}}function refreshChatList(){sendData('{"type":"allClient","clientId":"'+window.clientId+'"}')}function updateChatList(b){var a="";var c="";$.each(b.client,function(e,d){if((d.pseudo).trim()==""||d.pseudo==window.pseudo){return}if($.inArray((d.pseudo).toLowerCase(),window.friends)>0){c+='<div class="item"><img src="'+window.siteUrl+"user/avatar/"+d.pseudo+'/small/" class="avatar" alt="avatar de '+d.pseudo+'" /><a target="blank" title="Ouvrir le profil" href="'+window.siteUrl+"user/profile/"+d.pseudo+'/"><strong class="pseudo">'+d.pseudo+"</strong></a></div>"}else{a+='<div class="item"><img src="'+window.siteUrl+"user/avatar/"+d.pseudo+'/small/" class="avatar" alt="avatar de '+d.pseudo+'" /><a target="blank" title="Ouvrir le profil" href="'+window.siteUrl+"user/profile/"+d.pseudo+'/"><strong class="pseudo">'+d.pseudo+"</strong></a></div>"}});if(c==""){c="<i>Aucun ami connecté</i>"}$("#chat_container .chat_list").html('<div class="clients">'+a+'</div><span class="chat_break"><strong>Mes amis </strong>&nbsp;&nbsp;<a href="javascript:void(0);" onClick="refreshChatList();"><i class="fa fa-refresh"></i></a>&nbsp;&nbsp;<a href="javascript:void(0);" onClick="sound_chat = !sound_chat; refreshChatList();"><i class="fa fa-volume-'+(sound_chat?"up":"off")+'"></i></a></span><div class="friends">'+c+"</div>")};function initGamePage(a){refreshChatList();firstLoop=true;currentpage="game";$("#game").fadeOut("fast",function(){var b=$('<div id="game"><div class="grid"><div class="grid2-1 grid-game-resp"><div id="pageLeft"></div><div id="pageRight"><div id="helpBox"></div><div id="playersInfo"><div id="game_composition"></div></div><div id="gameControls"></div></div></div></div></div>').hide();$(this).replaceWith(b);game=a;initBoard(a);if(!spectateur){openHelpBox()}$("#game").fadeIn("fast");$("html, body").animate({scrollTop:$("#game").offset().top})});if(!spectateur){openNewChatBox("Team","chatbox_team")}else{openNewChatBox(unescape(a.gameName),"chatbox_all")}}function initBoard(c){$("#pageLeft").html("");$("#pageLeft").append("<canvas id='plateau'><canvas>");if(c.players!=null){$("#game_composition").html("");$("#game_composition").addClass("game_composition");$("#game_composition").addClass("game_composition"+c.nbTeams);for(var d=0;d<c.nbTeams;d++){if(d<c.nbTeams-1){$("#game_composition").append('<div id="team'+d+'" class="team team-vs"></div>')}else{$("#game_composition").append('<div id="team'+d+'" class="team"></div>')}}$.each(c.players,function(j,h){var f="";var g="";$.each(h.legionId,function(l,k){switch(tabFormes[k%c.nbTeams]){case"rectangle":g="fa fa-stop";break;case"circle":g="fa fa-circle";break;case"triangle":g="fa fa-play";break}f+='<i class="'+g+'" style="color:'+tabCouleurs[k]+';"></i>&nbsp;'});$("#team"+h.teamId).append('<div class="slot slot-'+(h.pseudo).toLowerCase()+'"><img src="'+window.siteUrl+"user/avatar/"+h.pseudo+'/small/" class="avatar avatar-small" alt="avatar de '+h.pseudo+'" /><strong class="txtcenter pseudo">'+h.pseudo+'</strong><span class="shapes">'+f+"</span></div>")})}var e=parseFloat($(window).height());var a=parseFloat(e);e=Math.min(e,a);a=e;var b=$("#plateau");b.attr("width",e);b.attr("height",e);$canvas=b;pingpong=[0];initTimer();plateau=drawBoard(c)}function deactivatePlayerGameComposition(a){$(".slot-"+a.exitPseudo).css("opacity",0.5)}function change_move_mode(){switch(move_mode){case"click":move_mode="drag";$.getScript(window.siteUrl+"/assets/js/game/draw_"+move_mode+".js").done(function(d,c){$("#change_move").text("Passez en mode clique")});break;case"drag":move_mode="click";$.getScript(window.siteUrl+"/assets/js/game/draw_"+move_mode+".js").done(function(d,c){$("#change_move").text("Passez en mode drag&drop")});break}}function initTimer(){var b=parseFloat($(window).height());var a=parseFloat(b);var c=Math.min(b,a);if($(window).width()<=768){timer_step=timer_step_mobile}else{timer_step=timer_step_desktop}timer.i=timer.initSec;timer.i=timer.i-avg(pingpong);clearInterval(timer.countdown);if($canvas.getLayer("timer")!=undefined){$canvas.setLayer("timer",{end:360});timer.countdown=setInterval(function(){countdown();timer.i=timer.i-(timer_step/1000)},timer_step)}else{$canvas.addLayer({type:"arc",name:"timer-border",strokeStyle:"#c6bfaf",strokeWidth:8,x:(c/2),y:(c/2),radius:((c-20)/2),start:0,end:360,});$canvas.addLayer({type:"arc",name:"timer",strokeStyle:"#fff",strokeWidth:5,x:(c/2),y:(c/2),radius:((c-20)/2),start:0,end:360,});$canvas.drawLayer("timer");timer.countdown=setInterval(function(){countdown();timer.i=timer.i-(timer_step/1000)},timer_step)}}function countdown(){if(timer.i<0){clearInterval(timer.countdown);return}$canvas.setLayer("timer",{end:(timer.i*360/timer.initSec)});$canvas.drawLayers()}function drawBoard(r){$("#gameControls").html("");if(!spectateur){$("#gameControls").append("<br/><button id='btnValideTour' onclick='valideMonTour();'>Valider mon tour</button><br/>")}$("#gameControls").append("<button id='exitGame'>Quitter</button>");if(move_mode=="click"&&!spectateur&&!is_touch_device()){$("#gameControls").append("<button id='change_move' onclick='change_move_mode();'>Passer en mode drag&drop</button>")}if(move_mode=="drag"&&!spectateur&&!is_touch_device()){$("#gameControls").append("<button id='change_move' onclick='change_move_mode();'>Passer en mode clic</button>")}$("#gameControls").append("<button id='disable_sound' onclick='disableGameSounds();'>"+(sound_game?"Désactiver les sons":"Réactiver les sons")+"</button>");var o=false;$("#exitGame").click(function(){if(!o){$(this).html("Cliquez pour confirmer");o=true}else{sendData('{"type":"exitGame","gameId":"'+r.gameId+'","clientId":"'+window.clientId+'"}');moi=null;initStartPage();destroyChatBox("chatbox_all");destroyChatBox("chatbox_team")}});var v=parseFloat($(window).width());if(v>768){v=v*0.6}else{v=v*0.9-20}var s=parseFloat($(window).height());v=Math.min(v,s);s=v;var z=$("#plateau");$canvas.attr("width",v);$canvas.attr("height",v);$canvas.setLayer("timer",{x:(s/2),y:(s/2),radius:((s-20)/2),});$canvas.setLayer("timer-border",{x:(s/2),y:(s/2),radius:((s-20)/2),});$canvas.removeLayerGroup("plateau");var F={};var q=r.boardRadius;var f=parseFloat(v/2);var k=parseFloat(s/2);var e=parseFloat((s/(q*2+1))/2);var d=r.cells;var c,g,p,n,C,E,j,h,b,a,m,l;var A;var D={};var t="";for(var B in d){c=d[B];g=c.uw.split(",");p=parseInt(g[0]);n=parseInt(g[1]);C=parseFloat(s/((4*q+4)));E=parseFloat(C*2/Math.sqrt(3));j=parseFloat(3/2*E);h=-C;b=0;a=parseFloat(2*C);m=parseFloat((p*j+n*b)+f);l=parseFloat((p*h+n*a)+k);t=window.siteUrl+"assets/img/game/laurel_bw.png";switch(p+","+n){case q+",0":if(c.soldier&&firstLoop){A=tabCouleurs2[c.legionId];tabBase[0]={pos:p+","+n,color:A}}else{A=tabBase[0].color}break;case"0,-"+q:if(c.soldier&&firstLoop){A=tabCouleurs2[c.legionId];tabBase[1]={pos:p+","+n,color:A}}else{A=tabBase[1].color}break;case q+","+q:if(c.soldier&&firstLoop){A=tabCouleurs2[c.legionId];tabBase[2]={pos:p+","+n,color:A}}else{A=tabBase[2].color}break;case"0,"+q:if(c.soldier&&firstLoop){A=tabCouleurs2[c.legionId];tabBase[3]={pos:p+","+n,color:A}}else{A=tabBase[3].color}break;case"-"+q+",0":if(c.soldier&&firstLoop){A=tabCouleurs2[c.legionId];tabBase[4]={pos:p+","+n,color:A}}else{A=tabBase[4].color}break;case"-"+q+",-"+q:if(c.soldier&&firstLoop){A=tabCouleurs2[c.legionId];tabBase[5]={pos:p+","+n,color:A}}else{A=tabBase[5].color}break;default:A="#fff";break}$canvas.drawPolygon({layer:true,bringToFront:false,name:p+","+n,fillStyle:A,strokeStyle:"#000",strokeWidth:1.2,x:m,y:l,radius:e,sides:6,rotate:60,click:function(i){}}).addLayerToGroup(p+","+n,"case").addLayerToGroup(p+","+n,"plateau");if(move_mode=="drag"){if(g==q+",0"||g=="0,-"+q||g==q+","+q||g=="0,"+q||g=="-"+q+",0"||g=="-"+q+",-"+q){$canvas.addLayer({type:"image",source:t,x:m,y:l,name:"b"+p+","+n,width:e,height:e,layer:true,radius:e}).addLayerToGroup("b"+p+","+n,"base").addLayerToGroup("b"+p+","+n,"plateau")}}F[p+","+n]=m+","+l;UWtoCell[p+","+n]=c}firstLoop=false;for(var B in d){c=d[B];g=c.uw.split(",");p=parseInt(g[0]);n=parseInt(g[1]);C=parseFloat(s/((4*q+4)));E=parseFloat(C*2/Math.sqrt(3));j=parseFloat(3/2*E);h=-C;b=0;a=parseFloat(2*C);m=parseFloat((p*j+n*b)+f);l=parseFloat((p*h+n*a)+k);if(c.soldier==true){if(tabFormes[c.legionId%game.nbTeams]==="rectangle"){drawArectangle(m,l,p,n,e,c)}if(tabFormes[c.legionId%game.nbTeams]==="circle"){drawAcircle(m,l,p,n,e,c)}if(tabFormes[c.legionId%game.nbTeams]==="triangle"){drawAtriangle(m,l,p,n,e,c)}}if(c.armor){drawAnArmor(m,l,p,n,e)}if(c.laurel){D={x:m,y:l,u:p,w:n,radius:e}}}drawLaurel(D.x,D.y,D.u,D.w,D.radius);$canvas.drawLayers();return F}function valideMonTour(){$(".btnResetCoup").each(function(){$(this).remove()});var a;for(var d in window.moncoup){a=window.moncoup[d];if(a!=null){sendData(JSON.stringify(a))}}var b=new Object();b.type="finishClientMovement";b.mvtType="finishClientMovement";b.clientId=window.clientId+"";b.gameId=game.gameId+"";sendData(JSON.stringify(b));$("#btnValideTour").html("En attente des autres joueurs.");$("#btnValideTour").prop("disabled",true);$canvas.setLayerGroup("case",{strokeStyle:"#000",strokeWidth:1,click:function(c){},touchend:function(c){},}).drawLayers();$canvas.setLayers({click:function(c){},draggable:false,touchend:function(c){}});$canvas.drawLayers()}function drawMouvment(e){var f=0;movedSolders=new Array();if(e.movements.soldierMovements!=undefined){playSound("move");var c,d,b;for(var a in e.movements.soldierMovements){c=e.movements.soldierMovements[a];d=$canvas.getLayer(c.celArr);movedSolders[c.celArr]=$canvas.getLayer("s"+c.celDep);if(!spectateur&&moi.playerLegionId.indexOf(c.legionId)==-1){$canvas.animateLayer("s"+c.celDep,{x:d.x,y:d.y},1000,function(g){if($canvas.getLayer("a"+c.celArr)!=undefined){$canvas.animateLayer(g.name,{strokeWidth:3,strokeStyle:"#000",},400,function(h){$canvas.removeLayer(h.name)});f=1500}})}if(spectateur){$canvas.animateLayer("s"+c.celDep,{x:d.x,y:d.y},1000,function(g){if($canvas.getLayer("a"+c.celArr)!=undefined){$canvas.animateLayer(g.name,{strokeWidth:3,strokeStyle:"#000",},400,function(h){$canvas.removeLayer(h.name)});f=1500}})}}}if(e.movements.laurelMovements!=undefined){var c=e.movements.laurelMovements[0];var d=$canvas.getLayer(c.celArr);$canvas.animateLayer("l"+c.celDep,{x:d.x,y:d.y},1000)}if(f==1500){return 1500}else{return 1000}}function drawFights(a){var g=0;var c=false;if(a!=undefined){var h,b,e;for(var d in a){h=a[d];if(h.fightLooser!==undefined){if(!c){playSound("fight")}if(!c){c=true}if(movedSolders[h.fightLooser]!=undefined){e=movedSolders[h.fightLooser];if(e.type=="rectangle"){$canvas.animateLayer(e.name,{width:0,height:0},1000)}else{$canvas.animateLayer(e.name,{radius:0},1000)}}else{e=$canvas.getLayer("s"+h.fightLooser);if(e.type=="rectangle"){$canvas.animateLayer("s"+h.fightLooser,{width:0,height:0},1000)}else{$canvas.animateLayer("s"+h.fightLooser,{radius:0},1000)}}}}g+=1000}return g}function drawTenailles(d){var c=0;var i=false;if(d!=undefined){var f,g,m,h,e,b,a,k,j;for(var l in d){f=d[l];if(f.firstTenailler!==undefined&&f.secondeTenailler!==undefined){if(!i){playSound("fight")}if(!i){i=true}if(movedSolders[f.firstTenailler]!=undefined){g=movedSolders[f.firstTenailler]}else{g=$canvas.getLayer("s"+f.firstTenailler)}if(movedSolders[f.secondeTenailler]!=undefined){m=movedSolders[f.secondeTenailler]}else{m=$canvas.getLayer("s"+f.secondeTenailler)}if(g!==undefined&&m!==undefined){h=Math.abs(g.x-m.x)/2;e=Math.abs(g.y-m.y)/2;if(g.x>m.x){h=g.x-h}else{h=g.x+h}if(g.y>m.y){e=g.y-e}else{e=g.y+e}var b=g.x;var k=g.y;var a=m.x;var j=m.y;$canvas.drawLine({layer:true,name:f.firstTenailler+f.secondeTenailler,groups:["plateau"],strokeStyle:"#000",strokeWidth:3,rounded:true,startArrow:true,arrowRadius:15,x1:h,y1:e,x2:b,y2:k,});$canvas.drawLayer(f.firstTenailler+f.secondeTenailler);$canvas.drawLine({layer:true,name:f.secondeTenailler+f.firstTenailler,groups:["plateau"],strokeStyle:"#000",strokeWidth:3,rounded:true,startArrow:true,arrowRadius:15,x1:h,y1:e,x2:a,y2:j,});$canvas.drawLayer(f.secondeTenailler+f.firstTenailler)}}c=2000}}return c}function drawAnArmor(b,e,d,c,a){$canvas.addLayer({type:"polygon",name:"a"+d+","+c,ayer:true,fillStyle:"#000",x:b,y:e,radius:a/100*50,sides:3,concavity:-0.65,rotate:180}).addLayerToGroup("a"+d+","+c,"plateau")}function getVoisins(f){var b=f.name.substring(1);var e=b.split(",");var c=parseInt(e[0]);var a=parseInt(e[1]);var d=[];d[0]={u:c+1,w:a};d[1]={u:c+1,w:a+1};d[2]={u:c,w:a+1};d[3]={u:c,w:a-1};d[4]={u:c-1,w:a-1};d[5]={u:c-1,w:a};return d}function getVoisinsLibres(d,c){var g=getVoisins(d);var e=[];var f;var a;a=UWtoCell[c.name.substring(1)];for(var b in g){if($canvas.getLayer("s"+g[b].u+","+g[b].w)==null&&$canvas.getLayer("l"+g[b].u+","+g[b].w)==null){f=UWtoCell[g[b].u+","+g[b].w];if(f!=null&&(f.armor==true&&a.isArmored==true)==false){e.push(g[b])}}}return e}function getCasesLibresPourGroupe(c){var a=[];var b=$canvas.getLayerGroup(c.groups[0]);var d=getMonGroupe(c);$.each(d,function(e,g){var f=getVoisinsLibres(g,c);$.each(f,function(i,h){var k=$.grep(a,function(j){return j.u==h.u&&j.w==h.w});if(k.length==0){a.push(f[i])}})});return a}function getMonGroupe(h){var l=[];l.push(h);var b=$canvas.getLayerGroup(h.groups[0]);var j=true;var f=0;var a=[];var g;var e=h.name.substring(1);var d=e.split(",");var c=parseInt(d[0]);var k=parseInt(d[1]);a.push({u:c,w:k});while(j&&f<b.length){var m=l.length;$.each(l,function(n,o){var i=getVoisins(o);g=$(i).not(a).get();$.each(g,function(p,r){var q=$canvas.getLayer("s"+r.u+","+r.w);if(q!=null){if(q.groups[0]==o.groups[0]){if(l.indexOf(q)==-1){l.push(q)}}}a.push(r)})});if(l.length==m){j=false}f++}return l}function getUWfromPixel(h,d,a){var g={u:"",w:""};var f,c,b;for(var e in plateau){f=e.split(",");c=parseInt(f[0]);b=parseInt(f[1]);xy=plateau[e].split(",");x=parseInt(xy[0]);y=parseInt(xy[1]);if((h<=x+a)&&(h>=x-a)&&(d<=y+a)&&(d>=y-a)){g={u:c,w:b,x:x,y:y}}}return g}function restartGame(){destroyChatBox("chatbox_all");destroyChatBox("chatbox_team");sendData('{"type":"restartGame","clientId":"'+window.clientId+'"}');closeBoxinfo()}function doNotRestartGame(){initStartPage();destroyChatBox("chatbox_all");destroyChatBox("chatbox_team");closeBoxinfo()}function disableGameSounds(){sound_game=!sound_game;var a=(sound_game?"Désactiver les sons":"Réactiver les sons");$("#disable_sound").html(a)};function openHelpBox(){if(window.helpStatus){$("#helpBox").append('			<div class=\'helpBox\'>			<input id="numHelpBox" type="hidden" value="1">				<i id="previousHelpBox" class="fa fa-angle-left" onclick="previousHelpBox()"> précédente</i>				<i id="nextHelpBox" class="fa fa-angle-right" onclick="nextHelpBox()"> suivante</i>				<i id="closeHelpBox" class="fa fa-times" onclick="closeHelpBox()"></i>				<div id="content"></div>				<input id="helpStatus" type="checkbox">Ne plus afficher</input>			</div>');var a=fillHelpBoxWithContent(1);$("#content").html(a)}}function closeHelpBox(){if($("#helpStatus").val()){window.helpStatus=false;$.post(window.siteUrl+"ajax/user/help/",{help:window.helpStatus}).done(function(a){$(".helpBox").remove()})}}function nextHelpBox(){var a=$("#numHelpBox").val();if(a<4){a++;$("#numHelpBox").val(a)}var b=fillHelpBoxWithContent(parseInt(a));$("#content").html(b)}function previousHelpBox(){var a=$("#numHelpBox").val();if(a>1){a--;$("#numHelpBox").val(a)}var b=fillHelpBoxWithContent(parseInt(a));$("#content").html(b)}function fillHelpBoxWithContent(a){switch(a){case 1:return"<p>Bienvenue dans votre première partie! Afin de vous guider ces messages vont vous indiquez la marche à suivre.</p>";break;case 2:return"<p>La barre autour du plateau de jeu symbolise le temps qu'il vous reste à jouer. Si vous avez fini votre tour vous pouvez le valider afin de gagner du temps. Si vous ne validez pas votre tour mais que vous avez joué des coups, ceux-ci seront validés automatiquement.</p>";break;case 3:return"<p>Vous disposez de 3 légions. Elles sont indiqués en dessous de ce message. Vous disposez d'un coup par légion. Afin de déplacer un soldat faites le glisser sur une case adjacente à votre légion.</p>";break;case 4:return"<p>Rappel déplacer le laurier compte comme un tour pour une de vos légions. Ainsi, si vous n'avez qu'une seule légion adjacente au laurier il vous suffit de le déplacer de la même manière que vos soldats. En revanche si plus d'une de vos légions est à proximité cliquez sur la légion pour laquelle vous souhaitez utiliser votre tour puis déplacez le laurier.</p>";break;default:return"<p>Oups, aucune aide disponible!</p>";break}};var socket;var plateau;var game;var $canvas;var UWtoCell={};var tabCouleurs={0:"#EB7A36",1:"#F9EE5E",2:"#B6CF34",3:"#6497C3",4:"#9170A8",5:"#D54E56"};var tabCouleurs2={0:"#fcdfc7",1:"#fffce2",2:"#daf2c4",3:"#cce5f9",4:"#ecd3ff",5:"#fccccc"};var tabFormes={0:"rectangle",1:"circle",2:"triangle",3:"rectangle",4:"circle",5:"triangle"};var tabBase={0:{pos:"0,0",color:"#ddd"},1:{pos:"0,0",color:"#ddd"},2:{pos:"0,0",color:"#ddd"},3:{pos:"0,0",color:"#ddd"},4:{pos:"0,0",color:"#ddd"},5:{pos:"0,0",color:"#ddd"}};var firstLoop;var moi=null;var spectateur=false;var movedSolders=new Array();var timer={name:"timer",initSec:30,i:30,countdow:null};var timer_step=200;var timer_step_desktop=200;var timer_step_mobile=1000;var currentpage="";var pingpong=[0];var latest_click;var move_mode="drag";var waitforroom=false;var sound_chat=true;var sound_game=true;jQuery(document).ready(function(a){if(is_touch_device()){move_mode="click"}a.getScript(window.siteUrl+"/assets/js/game/draw_"+move_mode+".js").done(function(b,c){initSocket()})});function initSocket(){socket=new WebSocket("ws://www.rtot.eu:3006");socket.onerror=function(a){};socket.onmessage=function(a){traiterReponseServeur(a.data)};socket.onopen=function(a){};socket.onclose=function(a){if(getBoxinfoStatus()!==false){openBoxinfo("deco",[{site_url:window.siteUrl}])}}}function sendData(b){try{socket.send((b))}catch(a){}}function traiterReponseServeur(b){var a=JSON.parse(b);switch(a.type){case"clientInformation":window.clientId=a.clientId;sendData('{"type":"connection","pseudo":"'+window.pseudo+'","userId":"'+window.userId+'","token":"'+window.token+'","clientId":"'+window.clientId+'"}');break;case"alreadyInActivity":if(!a.result){initStartPage()}initChat();break;case"myGameInformation":moi=new Object();moi.pseudo=window.pseudo;moi.playerId=a.playerId;moi.playerTeamId=a.playerTeamId;moi.playerLegionId=a.playerLegionId.legionId;break;case"notifyCreatedRoom":addRoomInList(a);break;case"notifyAllRoom":showRooms(a);break;case"notifyAllGame":showGames(a);break;case"joinedRoom":if(currentpage!="room"){waitroominfo=true;initRoomPage();setTimeout(function(){initRoom(a)},250)}else{initRoom(a)}break;case"roomInformation":setTimeout(function(){updateComposition(a)},300);break;case"playerExit":if(currentpage=="game"){deactivatePlayerGameComposition(a)}break;case"playerKicked":destroyChatBox("chatbox_all");initStartPage();break;case"answerJoinRoom":displayAnswerRoomMessage(a);break;case"gameCreated":window.moncoup={};if(a.timer!=undefined){timer.initSec=parseInt(a.timer);timer.i=parseInt(a.timer)}spectateur=(moi==null?true:false);initGamePage(a);break;case"gameUpdated":window.moncoup={};initTimer();if(a.gameAction!=undefined){var c=drawMouvment(a.gameAction);setTimeout(function(){if(a.gameAction.fights[0].allFights!=undefined||a.gameAction.fights[1].allTenailles!=undefined){var d=drawTenailles(a.gameAction.fights[1].allTenailles);setTimeout(function(){var e=drawFights(a.gameAction.fights[0].allFights);setTimeout(function(){plateau=drawBoard(a)},e)},d)}else{plateau=drawBoard(a)}},c)}break;case"endTurn":if(timer.i<2&&timer.i>-2){pingpong.push(timer.i)}clearInterval(timer.countdown);$canvas.setLayer("timer",{end:0});$canvas.drawLayers();if(!spectateur){valideMonTour()}break;case"chatMessage":receiveMessage(a);break;case"gameResult":if(!spectateur){controlswin='<a href="javascript:void(0)" onClick="restartGame();"><strong>Rejouer</strong></a> ou <a href="javascript:void(0)" onClick="doNotRestartGame();"><strong>non</strong></a>'}else{controlswin='<a href="javascript:void(0)" onClick="doNotRestartGame()"><strong>Je veux sortir d\'ici</strong></a>'}setTimeout(function(){var e="";var d=false;if(a.winnerPseudos!=null){$.each(a.winnerPseudos,function(f,g){if(g.pseudo==window.pseudo){d=true;playSound("win")}e+=g.pseudo+"<br/>"});openBoxinfo("gameResult",[{pseudos:e,controls:controlswin}],false)}if(!d&&!spectateur){playSound("lost")}},2000);break;case"connectError":switch(a.errorType){case 0:openBoxinfo("auth",[{site_url:window.siteUrl}],true);break;case 1:openBoxinfo("session",[{site_url:window.siteUrl}],true);break}break;case"checkConnection":sendData('{"type":"checkConnection", "clientId":"'+window.clientId+'"}');break;case"allClient":updateChatList(a);break;case"roomInvite":var a=JSON.parse('{"message": "Invitation : <a href=\\"javascript:void(0);\\" onClick=\\"joinRoom('+a.roomId+", '"+a.roomMdp+'\');\\">ici</a>", "target": "'+a.clientSource+'", "clientSource": "invite", "type": "chatMessage"}');receiveMessage(a);break}}function getAvatar(b,a){return window.siteUrl+"user/avatar/"+b+"/"+a+"/"}function playSound(b){if(b=="chat"&&!sound_chat){return}if(b!="chat"&&!sound_game){return}$("#audioPlay").remove();$("#game").after('<audio id="audioPlay"><source src="'+window.siteUrl+"assets/audio/"+b+'.mp3" type="audio/mpeg" /><source src="'+window.siteUrl+"assets/audio/"+b+'.wav" type="audio/wav"></audio>');var a=$("#audioPlay")[0];a.play()}function avg(d){var e=0;var c=0;var a=d.length;for(var b=0;b<a;b++){c+=parseFloat(d[b])}return parseFloat(c/a)}function is_touch_device(){return("ontouchstart" in window||"onmsgesturechange" in window)}function joinRoom(a,b){sendData('{"type":"joinRoom","roomId":"'+a+'","roomMdp":"'+b+'","clientId":"'+window.clientId+'"}')}function addHexColor(b,a){var c=(parseInt(b,16)+parseInt(a,16)).toString(16);while(c.length<6){c="0"+c}return c.substr(0,6)};function initRoomPage(){refreshChatList();$("#game").fadeOut("fast",function(){var a=$('<div id="game"><div class="grid"><div class="grid1-2"><div id="pageLeft"></div><div id="pageRight"><div id="game_composition"></div></div></div></div></div>').hide();$(this).replaceWith(a);$.ajax({url:window.siteUrl+"views/game/createRoom.html",cache:false,async:false,success:function(b){$("#pageLeft").html(b)}});$("#pageRight").prepend('<h2 class="game_name">Partie<h2></div>');updateCompositionStructure("normal",2,2,window.pseudo,0.5);$("[name='roomType']").change(function(){switch($(this).val()){case"normal":$(".form_create_room-all").slideDown("fast");updateCompositionStructure("normal",$("[name=nbTeams]").val(),$("[name=nbPlayers]").val(),window.pseudo);break;case"robot":$(".form_create_room-all").slideUp("fast");updateCompositionStructure("robot",2,2,window.pseudo,0.5);break}});$("[name=nbLegions]").change(function(){switch($(this).val()){case"1":$("[name=timer]").find("option[value=10]").attr("selected",true);break;case"2":$("[name=timer]").find("option[value=20]").attr("selected",true);break;case"3":$("[name=timer]").find("option[value=30]").attr("selected",true);break}});$("[name=nbTeams]").change(function(){updateCompositionStructure("normal",$(this).val(),$("[name=nbPlayers]").val(),window.pseudo,0.5)});$("[name=nbPlayers]").change(function(){var d=$(this).val();var c=$("[name=nbLegions]");var b=$("[name=nbTeams]");switch(d){case"2":b.find("option[value=2]").attr("disabled",false);b.find("option[value=3]").attr("disabled",true);c.find("option[value=1]").attr("disabled",false);c.find("option[value=2]").attr("disabled",false);c.find("option[value=3]").attr("disabled",false);b.find("option[value=2]").attr("selected",true);break;case"3":b.find("option[value=2]").attr("disabled",true);b.find("option[value=3]").attr("disabled",false);c.find("option[value=1]").attr("disabled",false);c.find("option[value=2]").attr("disabled",false);c.find("option[value=3]").attr("disabled",true);b.find("option[value=3]").attr("selected",true);c.find("option[value=1]").attr("selected",true);break;case"4":b.find("option[value=2]").attr("disabled",false);b.find("option[value=3]").attr("disabled",true);c.find("option[value=1]").attr("disabled",false);c.find("option[value=2]").attr("disabled",true);c.find("option[value=3]").attr("disabled",true);b.find("option[value=2]").attr("selected",true);c.find("option[value=1]").attr("selected",true);break;case"6":b.find("option[value=2]").attr("disabled",false);b.find("option[value=3]").attr("disabled",false);c.find("option[value=1]").attr("disabled",false);c.find("option[value=2]").attr("disabled",true);c.find("option[value=3]").attr("disabled",true);b.find("option[value=2]").attr("selected",true);c.find("option[value=1]").attr("selected",true);break}updateCompositionStructure("normal",b.val(),$(this).val(),window.pseudo,0.5)});$(".form_create_room").submit(function(c){c.preventDefault();var b={};b.type="createRoom";b.clientId=""+window.clientId;b.roomName=escape($("[name=roomName]").val()+"");b.roomMdp=($("[name=roomType]").val()!="robot"?$("[name=roomMdp]").val()+"":"");b.boardRadius=$("[name=boardRadius]").val()+"";b.nbPlayers=($("[name=roomType]").val()!="robot"?$("[name=nbPlayers]").val()+"":"2");b.nbTeams=($("[name=roomType]").val()!="robot"?$("[name=nbTeams]").val()+"":"2");b.nbLegions=($("[name=roomType]").val()!="robot"?(($("[name=nbPlayers]").val()*$("[name=nbLegions]").val())+""):((2*$("[name=nbLegions]").val())+""));b.roomType=$("[name=roomType]").val()+"";b.timer=$("[name=timer]").val()+"";sendData(JSON.stringify(b))});$(".form_create_room-cancel").click(function(b){b.preventDefault();initStartPage()});$("#game").fadeIn("fast")})}function initRoom(a){$(".form_create_room input, .form_create_room select").attr("disabled",true);$(".form_create_room input, .form_create_room select").css("opacity","0.5");$(".form_create_room input[type=submit], .form_create_room button").remove();$("[name=roomName]").val(a.roomName);$("[name=roomType]").val(a.roomType);$("[name=roomMdp]").val(a.roomMdp);$("[name=boardRadius]").val(a.boardRadius);$("[name=nbTeams]").val(a.nbTeams);$("[name=timer]").val(a.timer);$("[name=nbPlayers]").val(a.nbPlayers);$("[name=nbLegions]").val(a.nbLegions/a.nbPlayers);updateCompositionStructure("normal",a.nbTeams,a.nbPlayers,a.roomAdmin,1);if($("[name='roomType']").val()=="robot"){$(".form_create_room-all").slideUp("fast")}$("#pageRight").fadeOut("fast",function(){$(".game_name").replaceWith('<h2 class="game_name"><span class="visually-hidden" id="room_id_val">'+a.roomId+"</span>Partie "+unescape(a.roomName)+"<h2></div>");$("#pageRight").append('<br><div id="room_controls" class="txtcenter"><button id="room_exit">Quitter</button> <button id="room_ready">Je suis prêt</button></div><br>');$("#room_exit").click(function(b){sendData('{"type":"exitRoom","roomId":"'+a.roomId+'","clientId":"'+window.clientId+'"}');destroyChatBox("chatbox_all");initStartPage()});$("#room_ready").click(function(b){sendData('{"type":"playerReady","roomId":"'+a.roomId+'","clientId":"'+window.clientId+'"}');$("#room_controls").html("<button disabled>Vous êtes prêt !</button>")});$("#pageRight").fadeIn("fast")});openNewChatBox(unescape(a.roomName),"chatbox_all")}function swapPlayers(d,c){var b=d.html();var a=c.html();d.html(a);c.html(b);sendData('{"type":"switchPlayer","roomId":"'+$("#room_id_val").html()+'","numberPlayer1":"'+(d.attr("id")).replace("slot","")+'","numberPlayer2":"'+(c.attr("id")).replace("slot","")+'","clientId":"'+window.clientId+'"}')}function makeRobot(a){sendData('{"type":"createRobot","roomId":"'+$("#room_id_val").html()+'","numberRobot":"'+a+'","clientId":"'+window.clientId+'"}')}function kickPlayer(a){sendData('{"type":"kickPlayer","roomId":"'+$("#room_id_val").html()+'","numberKicked":"'+a+'","clientId":"'+window.clientId+'"}')}function updateComposition(a){$.each(a.players.player,function(c,b){if(b.pseudoPlayer!=""){if(window.pseudo==a.roomAdmin&&b.pseudoPlayer!=window.pseudo){$("#slot"+b.numberPlayer).html('<img src="'+window.siteUrl+"user/avatar/"+b.pseudoPlayer+'/medium/" class="avatar" alt="avatar de '+b.pseudoPlayer+'" /><strong class="txtcenter pseudo">'+b.pseudoPlayer+'&nbsp;&nbsp;<a href="javascript:void(0);" onclick="kickPlayer('+b.numberPlayer+')"><i class="fa fa-times-circle"></i></a></strong>')}else{$("#slot"+b.numberPlayer).html('<img src="'+window.siteUrl+"user/avatar/"+b.pseudoPlayer+'/medium/" class="avatar" alt="avatar de '+b.pseudoPlayer+'" /><strong class="txtcenter pseudo">'+b.pseudoPlayer+"</strong>")}if(window.pseudo==a.roomAdmin){$("#slot"+b.numberPlayer).draggable("enable")}if(b.pseudoPlayer==a.roomAdmin){$("#slot"+b.numberPlayer+" .avatar").addClass("avatar-admin")}else{$("#slot"+b.numberPlayer+" .avatar").removeClass("avatar-admin")}}else{if(window.pseudo==a.roomAdmin){$("#slot"+b.numberPlayer).html('<img src="'+window.siteUrl+'user/avatar/empty/medium/" class="avatar" alt="avatar par défaut" /><strong class="txtcenter pseudo"><a href="javascript:void(0);" onclick="makeRobot('+b.numberPlayer+')"><i class="fa fa-android"></i></a></strong>');$("#slot"+b.numberPlayer).draggable("disable")}else{$("#slot"+b.numberPlayer).html('<img src="'+window.siteUrl+'user/avatar/empty/medium/" class="avatar" alt="avatar par défaut" /><strong class="txtcenter pseudo">&nbsp;</strong>')}}})}function updateCompositionStructure(h,g,c,b,e){$("#game_composition").html("");$("#game_composition").css("opacity",e);$("#game_composition").removeClass();$("#game_composition").addClass("game_composition");$("#game_composition").addClass("game_composition"+g);if(h=="robot"){$("#game_composition").append('<div id="team0" class="team team-vs"><div id="slot1" class="slot"><img src="'+window.siteUrl+"user/avatar/"+b+'/medium/" class="avatar" alt="avatar de '+b+'" /><strong class="txtcenter pseudo">'+b+"</strong></div></div>");$("#game_composition").append('<div id="team1" class="team"><div id="slot0" class="slot"><img src="'+window.siteUrl+'user/avatar/robot/medium/" class="avatar" alt="avatar de robot" /><strong class="txtcenter pseudo">Robot</strong></div></div>')}else{var a=0;for(var f=0;f<g;f++){if(f<g-1){$("#game_composition").append('<div id="team'+f+'" class="team team-vs"></div>')}else{$("#game_composition").append('<div id="team'+f+'" class="team"></div>')}for(var d=0;d<c/g;d++){$("#team"+f).append('<div id="slot'+a+'" class="slot"><img src="'+window.siteUrl+'user/avatar/empty/medium/" class="avatar" alt="avatar par défaut" /><strong class="txtcenter pseudo">&nbsp;</strong></div>');$("#slot"+a).draggable({revert:true,zIndex:100});$("#slot"+a).draggable("disable");$("#slot"+a).droppable({drop:function(i,j){swapPlayers(j.draggable,$(this))}});a++}}}};function initStartPage(){refreshChatList();currentpage="start";$("#game").fadeOut("fast",function(){$(this).replaceWith($('<div id="game"><div class="grid"><div class="grid3"><div id="pageLeft"></div><div id="pageMiddle"></div><div id="pageRight"></div></div></div></div>').hide());$("#game").fadeIn("fast");initStart();sendData('{"type":"refreshRoomList","clientId":"'+window.clientId+'"}');sendData('{"type":"refreshGameList","clientId":"'+window.clientId+'"}');$.ajax({url:window.siteUrl+"views/game/rank.html",cache:false,async:false,success:function(a){$("#pageRight").append(a)}})})}function displayAnswerRoomMessage(a){if($("#room_item-"+a.roomId).length){var b=$("#room_item-"+a.roomId).parent();switch(a.state){case 3:if(b.find("[name=pwdJoinRoom]").length){b.find("[name=pwdJoinRoom]").addClass("room_pwd-error")}break}}}function initStart(){$(document).off("click",".nb_games");$(document).on("click",".nb_games",function(){$.get(window.siteUrl+"ajax/gamehistory/rank/",{type:"nb_games",}).done(function(a){$(".rank_box-content").html('<thead><tr><th>Pseudo</th><th>Parties</th></tr></thead><tbody class="rank_box-body"></tbody>');$.each(JSON.parse(a),function(b,c){$(".rank_box-body").append("<tr><td>"+c.player_name+"</td><td>"+c.nb+"</td></tr>")});$(".nb_games").addClass("rank_box-active");$(".nb_wins").removeClass("rank_box-active");$(".win_rate").removeClass("rank_box-active")})});$(document).off("click",".nb_wins");$(document).on("click",".nb_wins",function(){$.get(window.siteUrl+"ajax/gamehistory/rank/",{type:"nb_wins",}).done(function(a){$(".rank_box-content").html('<thead><tr><th>Pseudo</th><th>Victoires</th></tr></thead><tbody class="rank_box-body"></tbody>');$.each(JSON.parse(a),function(b,c){$(".rank_box-body").append("<tr><td>"+c.player_name+"</td><td>"+c.nb+"</td></tr>")});$(".nb_games").removeClass("rank_box-active");$(".nb_wins").addClass("rank_box-active");$(".win_rate").removeClass("rank_box-active")})});$(document).off("click",".win_rate");$(document).on("click",".win_rate",function(){$.get(window.siteUrl+"ajax/gamehistory/rank/",{type:"win_rate",}).done(function(a){$(".rank_box-content").html('<thead><tr><th>Pseudo</th><th>Ratio</th></tr></thead><tbody class="rank_box-body"></tbody>');$.each(JSON.parse(a),function(b,c){$(".rank_box-body").append("<tr><td>"+c.player_name+"</td><td>"+c.win_rate+"%</td></tr>")});$(".nb_games").removeClass("rank_box-active");$(".nb_wins").removeClass("rank_box-active");$(".win_rate").addClass("rank_box-active")})});$(document).off("click",".init_new_room");$(document).on("click",".init_new_room",function(){initRoomPage()});$(document).off("click",".show_more");$(document).on("click",".show_more",function(){var a=$(this).parent().parent().find(".room_item-more");if(!a.hasClass("opened")){a.addClass("opened");a.slideDown("fast");$(this).html("Voir -")}else{a.removeClass("opened");a.slideUp("fast");$(this).html("Voir +")}});$(document).off("click",".room_lock");$(document).on("click",".room_lock",function(){$(this).parent().replaceWith('<span class="room_pwd_container"><input type="password" class="room_pwd" name="pwdJoinRoom" /><button class="join_room btn-disabled">OK</button></span>')});$(document).off("click",".refresh_rooms");$(document).on("click",".refresh_rooms",function(){sendData('{"type":"refreshRoomList","clientId":"'+window.clientId+'"}')});$(document).off("click",".refresh_games");$(document).on("click",".refresh_games",function(){sendData('{"type":"refreshGameList","clientId":"'+window.clientId+'"}')});$("#pageLeft").html('<h2>Liste des rooms &nbsp;<a href="javascript:void(0);" style="color: #559;" class="refresh_rooms"><i class="fa fa-refresh"></i></a></h2><div class="room_item init_new_room txtcenter ptm pbm"><i class="fa fa-plus-circle" style="color:#333; font-size: 20px;"></i>&nbsp; Nouvelle partie</div><div id="room_list"></div>');$("#pageMiddle").html('<h2>Parties en cours &nbsp;<a href="javascript:void(0);" style="color: #559;" class="refresh_games"><i class="fa fa-refresh"></i></a></h2><div id="game_list"></div>');$.get(window.siteUrl+"ajax/gamehistory/rank/",{type:"nb_games",}).done(function(a){$(".rank_box-content").html('<thead><tr><th>Pseudo</th><th>Parties</th></tr></thead><tbody class="rank_box-body"></tbody>');$.each(JSON.parse(a),function(b,c){$(".rank_box-body").append("<tr><td>"+c.player_name+"</td><td>"+c.nb+"</td></tr>")});$(".nb_games").addClass("rank_box-active");$(".nb_wins").removeClass("rank_box-active");$(".win_rate").removeClass("rank_box-active")})}function showRooms(a){$("#room_list").html("");$(document).off("click",".join_room");$(document).on("click",".join_room",function(){var c="";var b=$(this).parent().parent().find(".room_item-roomId").html();if($(this).parent().find("[name=pwdJoinRoom]").length){c=$(this).parent().find("[name=pwdJoinRoom]").val();var b=$(this).parent().parent().parent().find(".room_item-roomId").html()}joinRoom(b,c)});if(a.roomsInformations.rooms!=null){$.each(a.roomsInformations.rooms,function(b,c){addRoomInList(c)})}else{$("#room_list").append('<i style="display: block;" class="empty_rooms pt1 pl3">Aucune room à afficher</i>')}}function addRoomInList(c){var b="";var a='<button class="show_more">Voir +</button><button class="join_room">Rejoindre</button>';if(c.roomSecurity==1){a='<button class="show_more">Voir +</button><span class="room_pwd_container"><button class="room_lock"><i class="fa fa-lock"></i></button></span>'}if(typeof c.playersPseudo.pseudos!=="undefined"){$.each(c.playersPseudo.pseudos,function(d,e){b+='<img class="avatar_small" src="'+getAvatar(e,"small")+'" alt="avatar de '+e+'" title="'+e+'" />'})}$(".empty_rooms").remove();$.ajax({url:window.siteUrl+"views/game/roomBox.html",cache:false,async:false,success:function(d){$("#room_list").append(tplawesome(d,[{roomId:c.roomId,boardRadius:c.boardRadius,playerCount:(c.nbCurrentPlayers+c.nbCurrentRobots)+"/"+c.nbPlayers,roomName:unescape(c.roomName),controls:a,more:"<p>Nombres d'équipes : "+c.nbTeams+"<br>Nombres de légions par joueur :"+(c.nbLegions/c.nbPlayers)+"</p>",players:b,}]))}})}function showGames(a){$("#game_list").html("");$(document).off("click",".watch_game");$(document).on("click",".watch_game",function(){sendData('{"type":"watchGame","gameId":"'+$(this).parent().parent().find(".room_item-roomId").html()+'","clientId":"'+window.clientId+'"}')});if(a.gamesInformations.games!=null){$.each(a.gamesInformations.games,function(d,b){var e="";if(typeof b.playersPseudo.pseudos!=="undefined"){$.each(b.playersPseudo.pseudos,function(f,g){e+='<img class="avatar_small" src="'+getAvatar(g,"small")+'" alt="avatar de '+g+'" title="'+g+'" />'})}var c='<button class="show_more">Voir +</button><button class="watch_game">Visionner</button>';$.ajax({url:window.siteUrl+"views/game/gameBox.html",cache:false,async:false,success:function(f){$("#game_list").append(tplawesome(f,[{gameId:b.gameId,boardRadius:b.boardRadius,gameName:unescape(b.gameName),controls:c,more:"<p>Nombres d'équipes : "+b.nbTeams+"<br>Nombres de légions par joueur :"+(b.nbLegions/b.nbPlayers)+"</p>",players:e}]))}})})}else{$("#game_list").append('<i style="display: block;" class="pt1 pl3">Aucune partie en cours</i>')}};function tplawesome(e,f){res=e;for(var d=0;d<f.length;d++){res=res.replace(/\{\{(.*?)\}\}/g,function(b,a){return f[d][a]})}return res};